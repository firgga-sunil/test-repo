kube-prometheus-stack:

  # Default values for kube-prometheus-stack - GCP Configuration
  nameOverride: "ck"
  fullnameOverride: "ck"

  global:
    imagePullSecrets:
      - name: ckn-ghcr-secret

  # Let this chart manage CRDs (Option A)
  crds:
    enabled: true

  # Prometheus Operator configuration
  prometheusOperator:
    enabled: true
    manageCRDs: true        # Let operator manage CRDs when SSA is enabled on Argo

    image:
      registry: ghcr.io
      repository: ckgitrepouser/codekarma/infra/prometheus-operator
      tag: v0.86.2
      pullPolicy: IfNotPresent

    prometheusConfigReloader:
      image:
        registry: ghcr.io
        repository: ckgitrepouser/codekarma/infra/prometheus-config-reloader
        tag: v0.86.2
        pullPolicy: IfNotPresent

    admissionWebhooks:
      enabled: true
      cert:
        image:
          registry: ghcr.io
          repository: ckgitrepouser/codekarma/infra/kube-webhook-certgen
          tag: v1.6.4
          pullPolicy: IfNotPresent
      patch:
        image:
          registry: ghcr.io
          repository: ckgitrepouser/codekarma/infra/kube-webhook-certgen
          tag: v1.6.4
          pullPolicy: IfNotPresent

  prometheus:
    enabled: true
    fullnameOverride: "ck-prometheus"
    prometheusSpec:
      image:
        registry: ghcr.io
        repository: ckgitrepouser/codekarma/infra/prometheus
        tag: v3.7.3
        pullPolicy: IfNotPresent

      maximumStartupDurationSeconds: 60
      podMonitorSelector: {}
      probeSelector: {}
      retention: 90d
      storageSpec:
        volumeClaimTemplate:
          spec:
            storageClassName: premium-rwo
            accessModes: ["ReadWriteOnce"]
            resources:
              requests:
                storage: 50Gi
      resources:
        requests:
          memory: "2048Mi"
          cpu: "2000m"
        limits:
          memory: "4096Mi"
          cpu: "4000m"

      affinity:
        nodeAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
              - matchExpressions:
                  - key: cloud.google.com/machine-family
                    operator: In
                    values:
                      - e2

      tolerations:
        - key: "nodetype"
          operator: "Equal"
          value: "e2"
          effect: "NoSchedule"

      securityContext:
        fsGroup: 2000
        runAsNonRoot: true
        runAsUser: 1000

      enableAdminAPI: true

    service:
      type: NodePort

  # Disable other components

  kubeApiServer:
    enabled: false

  prometheus-node-exporter:
    enabled: false
    image:
      registry: ghcr.io
      repository: ckgitrepouser/codekarma/infra/node-exporter
      tag: v1.10.2
      pullPolicy: IfNotPresent

  grafana:
    enabled: false
    image:
      registry: ghcr.io
      repository: ckgitrepouser/codekarma/infra/grafana
      tag: 12.3.0
      pullPolicy: IfNotPresent

  alertmanager:
    enabled: false
    alertmanagerSpec:
      image:
        registry: ghcr.io
        repository: ckgitrepouser/codekarma/infra/alertmanager
        tag: v0.29.0
        pullPolicy: IfNotPresent

  nodeExporter:
    enabled: false
    image:
      registry: ghcr.io
      repository: ckgitrepouser/codekarma/infra/node-exporter
      tag: v1.10.2
      pullPolicy: IfNotPresent

  kubeStateMetrics:
    enabled: false
    image:
      registry: ghcr.io
      repository: ckgitrepouser/codekarma/infra/kube-state-metrics
      tag: v2.17.0
      pullPolicy: IfNotPresent

  kubeControllerManager:
    enabled: false

  coreDns:
    enabled: false

  kubeEtcd:
    enabled: false

  kubeProxy:
    enabled: false

  kubeScheduler:
    enabled: false

  kubelet:
    serviceMonitor:
      enabled: false
    service:
      enabled: false

  defaultRules:
    create: false
  additionalServiceMonitors: []
